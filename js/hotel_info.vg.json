{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Hotel guest count information across states with occupancy rate for 2023 and 2024",
  "width": "container",
  "height": "500",
  "background": "white",
  "projection": {
    "type": "mercator",
    "scale": { "expr": "zoom" },
    "center": { "expr": "[centerLon, centerLat]" }
  },
  "title": {
    "text": "Malaysia Hotel Occupancy by State",
    "fontSize": 24,
    "font": "Inter",
    "fontWeight": "bold",
    "offset": 15
  },
  "params": [
    {
      "name": "centerLon",
      "value": 109.5
    },
    {
      "name": "centerLat",
      "value": 4
    },
    {
      "name": "zoom",
      "value": 3500,
      "bind": {
        "input": "range",
        "min": 500,
        "max": 5000,
        "step": 100,
        "name": "Zoom: "
      }
    },
    {
      "name": "ColorScheme",
      "value": "oranges",
      "bind": {
        "input": "select",
        "options": ["oranges", "blues", "greens"],
        "labels": ["Oranges", "Blues", "Greens"],
        "name": "Color Scheme: "
      }
    },
    {
      "name": "SelectedYear",
      "value": "TOTAL_2024",
      "bind": {
        "input": "select",
        "options": ["TOTAL_2024", "TOTAL_2023"],
        "labels": ["2024", "2023"],
        "name": "Selected Year: "
      }
    },
    {
      "name": "GuestType",
      "value": "TOTAL",
      "bind": {
        "input": "select",
        "options": ["DOMESTIC", "FOREIGNER", "TOTAL"],
        "labels": ["Domestic", "Foreigner", "Total"],
        "name": "Guest Type: "
      }
    }
  ],
  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
        "format": { "type": "topojson", "feature": "oceans" }
      },
      "mark": { "type": "geoshape", "fill": "#cce7ff" }
    },
    {
      "data": {
        "url": "./data/ne_10m_admin_1_states_provinces.topojson",
        "format": {
          "type": "topojson",
          "feature": "ne_10m_admin_1_states_provinces"
        }
      },
      "transform": [
        {
          "lookup": "properties.name",
          "from": {
            "data": { "url": "./data/hotel_guests.csv" },
            "key": "REGION",
            "fields": [
              "TOTAL 2024",
              "TOTAL 2023",
              "DOMESTIC 2024",
              "DOMESTIC 2023",
              "FOREIGNER 2024",
              "FOREIGNER 2023"
            ]
          }
        },
        {
          "lookup": "properties.name",
          "from": {
            "data": { "url": "./data/hotel_occupancy_rate.csv" },
            "key": "STATE",
            "fields": ["2024(%)", "2023(%)", "DIFFERENCE"]
          }
        },
        { "calculate": "toNumber(datum['TOTAL 2024'])", "as": "TOTAL_2024" },
        { "calculate": "toNumber(datum['TOTAL 2023'])", "as": "TOTAL_2023" },
        {
          "calculate": "toNumber(datum['DOMESTIC 2024'])",
          "as": "DOMESTIC_2024"
        },
        {
          "calculate": "toNumber(datum['DOMESTIC 2023'])",
          "as": "DOMESTIC_2023"
        },
        {
          "calculate": "toNumber(datum['FOREIGNER 2024'])",
          "as": "FOREIGNER_2024"
        },
        {
          "calculate": "toNumber(datum['FOREIGNER 2023'])",
          "as": "FOREIGNER_2023"
        },
        {
          "calculate": "GuestType=='TOTAL' ? (SelectedYear=='TOTAL_2024' ? datum['TOTAL_2024'] : datum['TOTAL_2023']) : (GuestType=='DOMESTIC' ? (SelectedYear=='TOTAL_2024' ? datum['DOMESTIC_2024'] : datum['DOMESTIC_2023']) : (SelectedYear=='TOTAL_2024' ? datum['FOREIGNER_2024'] : datum['FOREIGNER_2023']))",
          "as": "GUEST_SELECTED"
        }
      ],
      "mark": { "type": "geoshape", "stroke": "#333" },
      "encoding": {
        "color": {
          "field": "GUEST_SELECTED",
          "type": "quantitative",
          "scale": {
            "type": "threshold",
            "domain": [2000000, 6000000, 12000000],
            "scheme": { "expr": "ColorScheme" }
          },
          "legend": {
            "orient": "bottom-right",
            "direction": "horizontal",
            "title": "Guest Count"
          }
        },
        "tooltip": [
          { "field": "properties.name", "type": "nominal", "title": "State" },
          {
            "field": "GUEST_SELECTED",
            "type": "quantitative",
            "title": "Guests Count"
          },
          {
            "field": "2024(%)",
            "type": "quantitative",
            "title": "Occupancy Rate 2024 (%)"
          },
          {
            "field": "2023(%)",
            "type": "quantitative",
            "title": "Occupancy Rate 2023 (%)"
          },
          {
            "field": "DIFFERENCE",
            "type": "quantitative",
            "title": "Occupancy Rate Change (%)"
          }
        ]
      }
    },
    {
      "data": {
        "url": "./data/ne_10m_graticules_5.topojson",
        "format": { "type": "topojson", "feature": "ne_10m_graticules_5" }
      },
      "mark": { "type": "geoshape", "fill": null, "stroke": "#ddd" }
    }
  ]
}
